<!doctype html>
	<head>
		<link rel="stylesheet" href="style.v2.css">
		<title>Vaccine Distribution Certificates Generator</title>
	</head>
	<body>
        <div class="center">
            <div class="full-div">
                <h3>Vaccine Distribution Certificates Generator (<a href="https://github.com/Path-Check/paper-cred/blob/main/SPECIFICATION.md">Spec</a>)</h3>
                <div class="quarter">
                    <h4>Coupon</h4>
                    <table>
                        <tr><td>ID</td><td><input id="qr-coupon-id" type="text" placeholder="2"/></td></tr>
                        <tr><td>Coupons</td><td><input id="qr-coupon-coupons" type="text" placeholder="5000"/></td></tr>
                        <tr><td>Phase</td><td><input id="qr-coupon-phase" type="text" placeholder="1A, 2A, ..."/></td></tr>
                        <tr><td>City</td><td><input id="qr-coupon-city" type="text" placeholder="Somerville, MA, US..."/></td></tr>
                        <tr><td>Limits</td><td><input id="qr-coupon-indicator" type="text" placeholder="Diabetes, Teacher, Healthworker, Under 65, Over 65,...."/></td></tr>
                    </table>
                </div>
                <div class="quarter"> 
                    <h4>PassKey</h4>
                    <table>
                        <tr><td>Name</td><td><input id="qr-passkey-name" type="text" placeholder="Your Full Name ..."/></td></tr>
                        <tr><td>Phone</td><td><input id="qr-passkey-phone" type="text" placeholder="1617 .."/></td></tr>
                        <tr><td>DoB</td><td><input id="qr-passkey-dob" type="text" placeholder="YYYYMMDD"/></td></tr>
                        <tr><td>Salt</td><td><input id="qr-passkey-salt" type="text" placeholder="2342342"/></td></tr>
                    </table>
                </div>
                <div class="quarter">
                    <h4>Badge</h4>
                    <table>
                        <tr><td>Date</td><td><input id="qr-badge-date" type="text" placeholder=""/></td></tr>
                        <tr><td>Manuf</td><td><input id="qr-badge-manuf" type="text" placeholder="Pfizer, Moderna, ..."/></td></tr>
                        <tr><td>Product</td><td><input id="qr-badge-product" type="text" placeholder="COVID-19"/></td></tr>
                        <tr><td>Lot#</td><td><input id="qr-badge-lot" type="text" placeholder="012L20A, ..."/></td></tr>
                        <tr><td>Route</td><td><input id="qr-badge-route" type="text" placeholder="C38238, C38276, ..."/></td></tr>
                        <tr><td>Site</td><td><input id="qr-badge-site" type="text" placeholder="LA, RA,  ..."/></td></tr>
                        <tr><td>Dosage</td><td><input id="qr-badge-dose" type="text" placeholder="1000, 500, ..."/></td></tr>
                        <tr><td>Boosts</td><td><input id="qr-badge-required_doses" type="text" placeholder="28, 21, 0, ..."/></td></tr>
                        <tr><td>Private?</td><td><input id="qr-badge-private" type="checkbox" checked></td></tr>
                        <tr id="qr-badge-line-passkey"><td>Pass #</td><td><input id="qr-badge-vaccinee" type="text" placeholder="User Hash" readonly/></td></tr>
                        <tr id="qr-badge-line-passkey2" style="visibility: hidden;" ><td>Pass #</td><td><input id="qr-badge-vaccinee2" type="text" placeholder="User Hash" readonly/></td></tr>
                        <tr id="qr-badge-line-name" style="display: none;"><td>Name</td><td><input id="qr-badge-name" type="text" placeholder="Patient Name" readonly/></td></tr>
                        <tr id="qr-badge-line-dob"  style="display: none;"><td>DoB</td><td><input id="qr-badge-dob" type="text" placeholder="YYYYMMDD" readonly/></td></tr>
                    </table>
                </div>
                <div class="quarter">
                    <h4>Status</h4>
                    <table>
                        <tr><td>Doses</td><td><input id="qr-status-vaccinated" type="text" placeholder="0, 1, 2"/></td></tr>
                        <tr><td>Private?</td><td><input id="qr-status-private" type="checkbox" checked></td></tr>
                        <tr id="qr-status-line-passkey"><td>Pass #</td><td><input id="qr-status-vaccinee" type="text" placeholder="User Hash" readonly/></td></tr>
                        <tr id="qr-status-line-name" style="display: none;"><td>Holder</td><td><input id="qr-status-vaccinee-red" type="text" placeholder="FLYY" readonly/></td></tr>
                    </table>
                </div>
                
                <div class="quarter">
                    <h4>Credentials</h4>
                    <label for="privkey">Private Key <small>(openssl ecparam -name secp256k1 -genkey -out private.key)</small></label><br/>
<textarea id="privkey" rows="10" cols="30">-----BEGIN EC PARAMETERS-----
BgUrgQQACg==
-----END EC PARAMETERS-----
-----BEGIN EC PRIVATE KEY-----
MHQCAQEEIPWKbSezZMY1gCpvN42yaVv76Lo47FvSsVZpQl0a5lWRoAcGBSuBBAAK
oUQDQgAE6DeIun4EgMBLUmbtjQw7DilMJ82YIvOR2jz/IK0R/F7/zXY1z+gqvFXf
DcJqR5clbAYlO9lHmvb4lsPLZHjugQ==
-----END EC PRIVATE KEY-----</textarea>
                    <br><br>
                    <label for="pubkey">Public Key <small>(openssl ec -in private.key -pubout -out public.key)</small></label><br/>
                    <label for="pubkey"><small>1. DNS TXT Record FQDN</small></label><br/>
                    <label for="pubkey"><small>2. Direct URL to PEM Download</small></label><br/>
                    <label for="pubkey"><small>3. ID.DATABASE from <a href="https://github.com/Path-Check/paper-cred/tree/benefits_limitations/keys/pcf">PCF</a></small></label><br/>
                    <textarea id="qr-link" rows="1" cols="30">1a9.pcf</textarea>
                    <br><br>
                    <label for="privkey">QR Code Format</label><br/>
                    <pre>cred:<span class='protocol'>type:version</span>:<span class='signature'>Signature</span>:<span class='pub-key'>PubKey</span>:<span class='message'>Payload</span></pre>

                    <span class="checkboxes" ><input id="include-logos" type="checkbox"><label for="include-logos">Draw Symbols</label></span>
                </div>
            </div>
            <div class="full-div">
                <br><br>
                <div style="margin: 0 auto; width:500px; height:50px;">
                    <div class="center-in-div"> 
                        <button class="qr-btn" onclick="loadDemo()">Load Demo Data</button>
                        <button class="qr-btn" onclick="generateQRCodes()">Sign All Certificates</button>
                    </div>
                </div>
                <br><br>
            </div>
            <div class="full-div">
                <div class="quarter">
                    <canvas id="qr-coupon-code"></canvas><br/>
                    <pre id="qr-coupon-result"></pre>
                    <pre id="qr-coupon-verified"></pre>
                    <pre id="qr-coupon-bytes"></pre>
                </div>
                <div class="quarter">
                    <canvas id="qr-passkey-code"></canvas><br/>
                    <pre id="qr-passkey-result"></pre>
                    <pre id="qr-passkey-verified"></pre>
                    <pre id="qr-passkey-bytes"></pre>
                </div>
                <div class="quarter">
                    <canvas id="qr-badge-code"></canvas><br/>
                    <pre id="qr-badge-result"></pre>
                    <pre id="qr-badge-verified"></pre>
                    <pre id="qr-badge-bytes"></pre>
                </div>
                <div class="quarter">
                    <canvas id="qr-status-code"></canvas><br/>
                    <pre id="qr-status-result"></pre>
                    <pre id="qr-status-verified"></pre>
                    <pre id="qr-status-bytes"></pre>
                </div>
                <div class="quarter">
                    <label for="verify">Verify a QR Code</small></label><br/>
                    <textarea id="qr-verify" rows="10" cols="30" placeholder="cred:type:version:signature:pubkey:payload"></textarea>
                    <br><br>
                    <button class="qr-btn" onclick="verifyQRCode()">Verify</button>
                    <br><br>
                    <pre id="qr-verify-result"></pre>
                    <pre id="qr-verify-verified"></pre>
                </div>
            </div>
        </div>
        
        <script src="js/qrcode.min.js"></script>
        
        <script src="js/elliptic.min.js"></script>
        <script src="js/sha256.js"></script>
        <script src="js/asn1.min.js"></script>
        <script src="js/base32.min.js"></script>

		<script>
            const EC = elliptic.ec;
            const ANS1 = asn1;

            // PEM Definitions
            const ECPublicKey = ANS1.define("PublicKey", function() {
                this.seq().obj(
                    this.key("algorithm").seq().obj(
                        this.key("id").objid(),
                        this.key("curve").objid()
                    ),
                    this.key("pub").bitstr()
                );
            });
            const ECPrivateKey = ANS1.define("ECPrivateKey", function() {
                this.seq().obj(
                    this.key('version').int().def(1),
                    this.key('privateKey').octstr(),
                    this.key('parameters').explicit(0).objid().optional(),
                    this.key('publicKey').explicit(1).bitstr().optional()
                );
            });

            const algos = {'1.2.840.10045.2.1':'Elliptic curve public key cryptography'};
            const curves = {'1.3.132.0.10': 'secp256k1'};

            function e(elem) { return document.getElementById(elem); }

            function buildPayload(elemArray) {
                const fields = elemArray.map(function(elemId) {
                    return encodeURIComponent(e(elemId).value.toUpperCase());
                })
                return fields.join('/');
            }
            function buildHashPayload(elemArray) {
                const RS = String.fromCharCode(30);
                let fields = elemArray.map(function(elemId) {
                    return e(elemId).value.toUpperCase();
                })
                return fields.join(RS);
            }

            function pad(base32Str) {
                switch (base32Str.length % 8) {
                    case 2: return base32Str + "======"; 
                    case 4: return base32Str + "===="; 
                    case 5: return base32Str + "==="; 
                    case 7: return base32Str + "="; 
                }
                return base32Str;
            }

            function rmPad(base32Str) {
                return base32Str.replaceAll("=", "");
            }

            function verifySignature(pubkey, payload, signatureBase32NoPad, feedback_elem_id) {
                try {
                    // Decoding the public key to get curve algorithm + key itself
                    const pubk = ECPublicKey.decode(pubkey, 'pem', {label: 'PUBLIC KEY'});

                    // Get Encryption Algorithm: EC
                    const algoCode = pubk.algorithm.id.join('.');
                    // Get Curve Algorithm: secp256k1
                    const curveCode = pubk.algorithm.curve.join('.');
                    
                    // Prepare EC with assigned curve
                    const ec = new EC(curves[curveCode]);
                    
                    // Load public key from PEM as DER
                    const key = ec.keyFromPublic(pubk.pub.data, 'der');

                    // Converts to UTF-8 -> WorldArray -> SHA256 Hash 
                    const payloadSHA256 = CryptoJS.SHA256(payload).toString();

                    // Gets the Base32 enconded, add padding and convert to DER.
                    const signatureDER = base32.decode.asBytes(pad(signatureBase32NoPad));

                    // Verifies Signature. 
                    const verified = key.verify(payloadSHA256, signatureDER);

                    // Updates screen. 
                    e(feedback_elem_id).innerHTML = "Signature: " + (verified ? "Verified" : "Not Valid");
                } catch(err) {
                    e(feedback_elem_id).innerHTML += "Signature Verification Failed: " + err;
                    console.error(err);
                }
            }

            function downloadAndVerify(pubkeyURL, payload, signatureBase32NoPad, feedback_elem_id) {
                // Download pubkey to verify
                let client = new XMLHttpRequest();
                    
                try {
                    // Try to download from the DNS TXT record. 
                    client.open('GET', "https://dns.google/resolve?name=" + pubkeyURL + '&type=TXT', false);
                    client.send();

                    const jsonResponse = JSON.parse(client.response);
                    if (jsonResponse.Answer) {
                        const pubKeyTxtLookup = JSON.parse(client.response).Answer[0].data
                        const noQuotes = pubKeyTxtLookup.substring(1, pubKeyTxtLookup.length - 1).replaceAll("\\n","\n");
                            
                        if (noQuotes.includes("-----BEGIN PUBLIC KEY-----")) {   
                            verifySignature(noQuotes, payload, signatureBase32NoPad, feedback_elem_id);
                            return;
                        }
                    }
                } catch(err) {
                    e(feedback_elem_id).innerHTML += "Verification Failed: " + err;
                    console.error(err);
                }    

                try {
                    // Try to download as a file. 
                    client.open('GET', "https://" + pubkeyURL, false);
                    client.send();

                    if (client.response.includes("-----BEGIN PUBLIC KEY-----")) { 
                        verifySignature(client.response, payload, signatureBase32NoPad, feedback_elem_id); 
                        return;
                    }
                } catch(err) {
                    console.error(err);
                }

                try {   
                    console.log("Trying GitHub");
                    let publicKey = getGitHubDatabase(pubkeyURL.split('.')[0], pubkeyURL.split('.')[1]);
                    console.log(publicKey);
                    if (publicKey != undefined && publicKey.includes("-----BEGIN PUBLIC KEY-----")) { 
                        verifySignature(publicKey, payload, signatureBase32NoPad, feedback_elem_id); 
                        return;
                    }
                } catch(err) {
                    console.error(err);
                }
            }

            function signAndDisplayQR(elemPref, protocol, priKeyPEM, pubKeyLink, payload) {
                // Load Primary Key
                const ec_pk = ECPrivateKey.decode(priKeyPEM, 'pem', {label: 'EC PRIVATE KEY'});
                
                // Get Curve Algorithm.
                const curveCode = ec_pk.parameters.join('.');
                
                // Prepare EC with assigned curve: secp256k1
                const ec = new EC(curves[curveCode]);

                // Load Private Key from PEM file converted to DER.
                const key = ec.keyFromPrivate(ec_pk.privateKey, 'der');

                // Converts to UTF-8 -> WorldArray -> SHA256 Hash 
                const payloadSHA256 = CryptoJS.SHA256(payload).toString();
                
                // Signs, gets a DER
                const signatureDER = key.sign(payloadSHA256).toDER();

                // Converts DER to Base32 and remove padding. 
                const signature = rmPad(base32.encode(signatureDER));
                
                // Builds URI
                const uri = protocol.toUpperCase()+":"+signature+":"+pubKeyLink.toUpperCase()+":"+payload;

                const params = { margin:0, width:275, errorCorrectionLevel: 'M', color: {dark: '#3654DD' }};

                // Builds QR Element
                QRCode.toCanvas(e(elemPref+'-code'), uri, params, function (error) {
                    if (e("include-logos").checked) {
                        //adding a logo at center        
                        const imgDim={width:50,height:50}; //logo dimention
                        var context = e(elemPref+'-code').getContext('2d');
                        var imageObj = new Image();  
                        if (e(elemPref+'-private')) {
                            if (e(elemPref+'-private').checked)
                                imageObj.src = './img/closelocker.jpg';  
                            else
                                imageObj.src = './img/openlocker.jpg';
                        } else if (elemPref === 'qr-passkey') {
                            imageObj.src = './img/passkey.png'; 
                        } else {
                            imageObj.src = './img/logo.jpg';  
                        }      
                        imageObj.onload = function() {
                            context.drawImage(imageObj, 
                            e(elemPref+'-code').width / 2 - imgDim.width / 2 +1,
                            e(elemPref+'-code').height / 2 - imgDim.height / 2,imgDim.width,imgDim.height);
                        }; 
                    } 
                })

                // Updates screen elements. 
                e(elemPref+"-result").innerHTML= "<span class='protocol'>"+protocol.toUpperCase()+"</span>:" + 
                                            "<span class='signature'>" + signature + "</span>" + ":" +
                                            "<span class='pub-key'>" + pubKeyLink.toUpperCase() + "</span>" + ":" +
                                            "<span class='message'>" + payload + "</span><br><br>";
                //                            "Signature DER: <span class='signature'>" + signatureDER + "</span><br><br>"+
                //                            "Payload SHA256 Hash: <span class='message'>" + payloadSHA256 + "</span><br><br>";
                e(elemPref+"-verified").innerHTML = "Signature: Not Verified";
                
                //e(elemPref+"-bytes").innerHTML = "QR Size: "+ Math.round((uri.length / 2) * 11/8) + " bytes";

                let qr = QRCode.create(uri, params);

                e(elemPref+"-bytes").innerHTML = "QR Version: " + qr.version;
                e(elemPref+"-bytes").innerHTML += " (" + qr.modules.size + "x" + qr.modules.size + "bits, " + Math.round((qr.modules.size*qr.modules.size)/8) + "bytes)";

                e(elemPref+"-bytes").innerHTML += "<br><br>Using " + qr.segments.length + " segments";
                for (i=0; i<qr.segments.length; i++) {
                    e(elemPref+"-bytes").innerHTML += "<br>- " + i + ": " + qr.segments[i].mode.id + " " + qr.segments[i].data;
                }
                
                // Verifies URI is valid
                downloadAndVerify(pubKeyLink, payload, signature, elemPref + "-verified");
            }

            function generateQRCodes() {
                // Where to Download the public key
                const pubKeyLink = e("qr-link").value.trim().replace("http://","");

                // PEM code of the private key
                const priKeyPEM = e('privkey').value;

                // Build PassKeyHash
                const hashedPassKey = buildHashPayload(["qr-passkey-name", "qr-passkey-dob", "qr-passkey-salt", "qr-passkey-phone"]);
                const digest = CryptoJS.SHA256(hashedPassKey).toString();
                const hashPassKeyBase32 = rmPad(base32.encode(digest));
                
                if (e("qr-badge-private").checked) {
                    // Update fields on Screen
                    e("qr-badge-vaccinee").value = hashPassKeyBase32;
                    e("qr-badge-name").value = "";
                    e("qr-badge-dob").value = "";
                } else {
                    e("qr-badge-vaccinee").value = "";
                    e("qr-badge-name").value = e("qr-passkey-name").value;
                    e("qr-badge-dob").value = e("qr-passkey-dob").value;
                }

                if (e("qr-status-private").checked) {
                    e("qr-status-vaccinee").value = hashPassKeyBase32;
                    e("qr-status-vaccinee-red").value = ""
                } else {
                    e("qr-status-vaccinee").value = ""
                    e("qr-status-vaccinee-red").value = getInitialsAndYear(e("qr-passkey-name").value, e('qr-passkey-dob').value);
                }

                // Coupon QR
                const couponArray = ["qr-coupon-id", "qr-coupon-coupons", "qr-coupon-city", "qr-coupon-phase", "qr-coupon-indicator"];
                signAndDisplayQR("qr-coupon", "cred:coupon:1", priKeyPEM, pubKeyLink, buildPayload(couponArray));

                // PassKey QR
                const passKeyArray = ["qr-passkey-name", "qr-passkey-dob", "qr-passkey-salt", "qr-passkey-phone"];  
                signAndDisplayQR("qr-passkey", "cred:passkey:1", priKeyPEM, pubKeyLink, buildPayload(passKeyArray));

                // Badge QR
                const badgeArray = ["qr-badge-date", "qr-badge-manuf", "qr-badge-product", "qr-badge-lot", 
                                  "qr-badge-required_doses", "qr-badge-vaccinee", "qr-badge-route", 
                                  "qr-badge-site", "qr-badge-dose", "qr-badge-name", "qr-badge-dob"];
                signAndDisplayQR("qr-badge", "cred:badge:2", priKeyPEM, pubKeyLink, buildPayload(badgeArray));
 
                // Status QR
                const statusArray = ["qr-status-vaccinated", "qr-status-vaccinee", "qr-status-vaccinee-red"];
                signAndDisplayQR("qr-status", "cred:status:2", priKeyPEM, pubKeyLink, buildPayload(statusArray));
            }

            function parseQR(qr) {
                return [schema, type, version, signatureBase32NoPad, pubKeyLink, payload] = qr.split(':');
            }

            function getPayloadTypes() {
                let client = new XMLHttpRequest();
                try {
                    client.open('GET', "https://api.github.com/repos/Path-Check/paper-cred/git/trees/main", false);
                    client.setRequestHeader("Accept", "application/vnd.github.v3+json");
                    client.send();

                    const filesRoot = JSON.parse(client.response).tree
                    const payloadsDir = filesRoot.find(element => element.path === 'payloads');

                    client.open('GET', "https://api.github.com/repos/Path-Check/paper-cred/git/trees/"+payloadsDir.sha, false);
                    client.setRequestHeader("Accept", "application/vnd.github.v3+json");
                    client.send();

                    const payloads = JSON.parse(client.response).tree.map(x => x.path.replaceAll(".md","").replaceAll(".",":"));

                    return payloads;
                } catch(err) {
                    console.error(err);
                }
            }

            function getTXT(url) {
                let client = new XMLHttpRequest();
                client.open('GET', url, false);
                client.setRequestHeader("Accept", "application/vnd.github.v3+json");
                client.send();
                console.log(client.response);
                return client.response;
            }

            function getJSON(url) {
                return JSON.parse(getTXT(url));
            }

            function getGitHubDatabase(id, database) {
                console.log(id, database);
                const githubTree = "https://api.github.com/repos/Path-Check/paper-cred/git/trees";
                const githubBlob = "https://api.github.com/repos/Path-Check/paper-cred/git/blobs";
                try {
                    const rootDir = getJSON(githubTree + "/" + "benefits_limitations").tree
                    const databasesDir = rootDir.find(element => element.path === 'keys');

                    if (databasesDir === undefined) return;

                    const databases = getJSON(githubTree+"/"+databasesDir.sha).tree
                    const databaseDir = databases.find(element => element.path === database);

                    if (databaseDir === undefined) return;

                    const idsFiles = getJSON(githubTree+"/"+databaseDir.sha).tree
                    const idFile = idsFiles.find(element => element.path === id+'.pem');

                    if (idFile === undefined) return;

                    const publicKeyPem = atob(getJSON(githubBlob+"/"+idFile.sha).content)

                    return publicKeyPem;
                } catch(err) {
                    console.error(err);
                }
            }


            function verifyQRCode() {
                e("qr-verify-result").innerHTML = "";
                e('qr-verify-verified').innerHTML = "";

                const qr = e("qr-verify").value;
                
                if (qr === "") {
                    e('qr-verify-verified').innerHTML += "Field is empty. It's not a valid URI.<br>";
                    return;
                }

                try {
                    parseQR(qr);
                    e('qr-verify-verified').innerHTML += "QR was parsed sucessfully!<br><br>";
                } catch (err) {
                    e('qr-verify-verified').innerHTML += "Could not parse string into the URI format.<br>";
                    return;
                }                

                const [schema, type, version, signatureBase32NoPad, pubKeyLink, payload] = parseQR(qr);
                
                // Updates screen elements. 
                e("qr-verify-result").innerHTML = "<span class='protocol'>"+schema+":"+type+":"+version+"</span>:" + 
                                            "<span class='signature'>" + signatureBase32NoPad + "</span>" + ":" +
                                            "<span class='pub-key'>" + pubKeyLink + "</span>" + ":" +
                                            "<span class='message'>" + payload + "</span><br><br>";
                                            
                if (schema.toLowerCase() !== "cred") {
                    e('qr-verify-verified').innerHTML += "QR is not a credential: Code must start with CRED instead of "+schema +".<br>";
                }

                const availablePayloads = getPayloadTypes();

                if (!availablePayloads.includes(type.toLowerCase()+":"+version)) {
                    e('qr-verify-verified').innerHTML += "Type or version <b>" + type + ":" + version + "</b> was not recognized. Make sure this payload type and version are available on <a href='https://github.com/Path-Check/paper-cred/tree/main/payloads'>GitHub</a> <br>";
                }

                if (e('qr-verify-verified').innerHTML === "QR was parsed sucessfully!<br><br>") {
                    downloadAndVerify(pubKeyLink, payload, signatureBase32NoPad, 'qr-verify-verified');
                } else {
                    e('qr-verify-verified').innerHTML += "<br>Signature: not verified";
                }
            }

            function getInitialsAndYear(fullName, dob) {
                var names = fullName.split(' '),
                    initials = names[0].substring(0, 1).toUpperCase();
                
                if (names.length > 1) {
                    initials += names[names.length - 1].substring(0, 1).toUpperCase();
                }

                return initials + dob.substring(2,4);
            };
        </script>
        
        <script>
            e("qr-badge-private").addEventListener('change', () => {
                e("qr-badge-line-name").style.display = e("qr-badge-private").checked ? 'none': '';
                e("qr-badge-line-dob").style.display = e("qr-badge-private").checked ? 'none': '';
                e("qr-badge-line-passkey").style.display = e("qr-badge-private").checked ? '' :'none';
                e("qr-badge-line-passkey2").style.display = e("qr-badge-private").checked ? '' :'none';

                if (e("qr-badge-private").checked) {
                    e("qr-badge-name").value = "";
                    e("qr-badge-dob").value = "";
                } else {
                    e("qr-badge-vaccinee").value = "";
                }
            });

            e("qr-status-private").addEventListener('change', () => {
                e("qr-status-line-name").style.display = e("qr-status-private").checked ? 'none': '';
                e("qr-status-line-passkey").style.display = e("qr-status-private").checked ? '' :'none';
                
                if (e("qr-status-private").checked) {
                    e("qr-status-vaccinee-red").value = "";
                } else {
                    e("qr-status-vaccinee").value = "";
                }
            });

            // Defaults
            e("qr-badge-date").value = new Date().toJSON().slice(0, 10).replaceAll("-","");

            // Salt 
            e("qr-passkey-salt").value = Math.random().toString(36).substring(3);

            function loadDemo() {
                // Salt 
                e("qr-passkey-salt").value = Math.random().toString(36).substring(3);

                e("qr-badge-name").value = "";
                e("qr-badge-dob").value = "";
                e("qr-badge-vaccinee").value = "";
                e("qr-status-vaccinee-red").value = "";
            
                e("qr-coupon-id").value = "1";
                e("qr-coupon-coupons").value = 5000;
                e("qr-coupon-phase").value = "1A";
                e("qr-coupon-city").value = "Somerville MA US";
                e("qr-coupon-indicator").value = ">65";
                
                e("qr-passkey-name").value = "Jane Doe";
                e("qr-passkey-phone").value = "16173332345";
                e("qr-passkey-dob").value = "19820321";

                e("qr-badge-manuf").value = "Moderna";
                e("qr-badge-product").value = "COVID19";
                e("qr-badge-lot").value = "012L20A";
                e("qr-badge-route").value = "C28161";
                e("qr-badge-site").value = "RA";
                e("qr-badge-dose").value = "500";
                e("qr-badge-required_doses").value = "28";

                e("qr-status-vaccinated").value = "1";
                e("qr-status-vaccinee").value = "";
            }
        </script>
	</body>
</html>


